(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{741:e=>{e.exports={loadingContainer:"LoadingState_loadingContainer__PZXtk",spinner:"LoadingState_spinner__aq70G",spin:"LoadingState_spin__gUl_D"}},962:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(5155);function a(e){let{className:t=""}=e;return(0,n.jsx)("img",{src:"/icons/hipaa.png",alt:"HIPAA Compliant",className:t})}s(2115)},968:e=>{e.exports={container:"SessionList_container__Bntgt",list:"SessionList_list__fO2vt",clientGroup:"SessionList_clientGroup__eqCYY",clientHeader:"SessionList_clientHeader__xejN9",noteCard:"SessionList_noteCard__lTVk7",noteHeader:"SessionList_noteHeader__OZ2Nz",noteActions:"SessionList_noteActions__OJsKY",copyBtn:"SessionList_copyBtn__tqjJK",editBtn:"SessionList_editBtn__N_EW9",saveBtn:"SessionList_saveBtn__usSNR",noteSection:"SessionList_noteSection__DUoi_",pre:"SessionList_pre___TVJu",richText:"SessionList_richText__erpoA",textarea:"SessionList_textarea__a3G0g"}},1240:(e,t,s)=>{"use strict";s.d(t,{A:()=>u});var n=s(5155),a=s(6874),o=s.n(a),r=s(6766),i=s(5695),c=s(6918),l=s.n(c),d=s(962);function u(){let e=(0,i.usePathname)();return(0,n.jsxs)("nav",{className:l().nav,children:[(0,n.jsx)("div",{className:l().brandContainer,children:(0,n.jsxs)(o(),{href:"/dashboard",className:l().brand,children:[(0,n.jsx)(r.default,{src:"/couchicon2.png",alt:"terapai Logo",width:32,height:32}),"terapai"]})}),(0,n.jsxs)("div",{className:l().menu,children:[(0,n.jsx)(o(),{href:"/dashboard",className:l().link,"aria-current":"/dashboard"===e?"page":void 0,children:"Dashboard"}),(0,n.jsx)(o(),{href:"/account",className:l().link,"aria-current":"/account"===e?"page":void 0,children:"My Account"})]}),(0,n.jsx)("div",{className:l().complianceContainer,children:(0,n.jsx)(d.A,{className:l().hipaaIcon})})]})}},2239:(e,t,s)=>{"use strict";s.d(t,{j:()=>c,k:()=>l});var n=s(3915),a=s(6203),o=s(5317);let r={apiKey:"AIzaSyB8XOlU5pDZV0FWvnRLk3520uYEgwbVmac",authDomain:"therascript-45b62.firebaseapp.com",projectId:"therascript-45b62",storageBucket:"therascript-45b62.appspot.com",messagingSenderId:"64757237031",appId:"1:64757237031:web:c541b0cf649c0d88fb5502"};console.log("\uD83D\uDD25 Firebase config being used:",r);let i=(0,n.Dk)().length?(0,n.Dk)()[0]:(0,n.Wp)(r),c=(0,a.getAuth)(i),l=(0,o.aU)(i)},2519:e=>{e.exports={card:"SessionCard_card__F_F_y",header:"SessionCard_header__0h8QK",date:"SessionCard_date__9nT1K",preview:"SessionCard_preview__a_FKJ",actions:"SessionCard_actions__GfjwT",actionButton:"SessionCard_actionButton__2cyyl"}},2733:e=>{e.exports={toggleContainer:"ViewToggle_toggleContainer__V74Lg",toggleButton:"ViewToggle_toggleButton__oDJ0r",active:"ViewToggle_active__74Pqq"}},4163:e=>{e.exports={container:"DashboardPage_container__YfJ3s",header:"DashboardPage_header__B1nHY",stats:"DashboardPage_stats__DkFWu",statCard:"DashboardPage_statCard__RzsPa",statLabel:"DashboardPage_statLabel__lmwBW",statValue:"DashboardPage_statValue__Jlp_X",loading:"DashboardPage_loading__cC_FQ",error:"DashboardPage_error__tNcO_",empty:"DashboardPage_empty__tDufG",newSessionBtn:"DashboardPage_newSessionBtn__UN2ml",gridContainer:"DashboardPage_gridContainer__zFdy5",sidebar:"DashboardPage_sidebar___ELfN",welcome:"DashboardPage_welcome__4fIco",subtitle:"DashboardPage_subtitle__qwBdt",newNoteBtn:"DashboardPage_newNoteBtn__Ood_C",mainContent:"DashboardPage_mainContent__GFl4A",assistPanel:"DashboardPage_assistPanel___6grp"}},4454:(e,t,s)=>{Promise.resolve().then(s.bind(s,8300))},5695:(e,t,s)=>{"use strict";var n=s(8999);s.o(n,"notFound")&&s.d(t,{notFound:function(){return n.notFound}}),s.o(n,"useParams")&&s.d(t,{useParams:function(){return n.useParams}}),s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},6918:e=>{e.exports={nav:"TopNav_nav__m5fHp",brandContainer:"TopNav_brandContainer__Hy1ZJ",brand:"TopNav_brand__dnJ68",menu:"TopNav_menu__oyHiN",link:"TopNav_link__evmW_",complianceContainer:"TopNav_complianceContainer__B1Rmc",hipaaIcon:"TopNav_hipaaIcon__8uLkV"}},7078:e=>{e.exports={container:"EmptyState_container__tFfI3",icon:"EmptyState_icon__PgjKT",title:"EmptyState_title__AHRV7",message:"EmptyState_message__PBI7S",button:"EmptyState_button__HowC3"}},8300:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>L});var n=s(5155),a=s(2115),o=s(5695),r=s(2239),i=s(968),c=s.n(i),l=s(2519),d=s.n(l);function u(e){var t;let{note:s,onClick:a,onUpdate:o,onDelete:r}=e;if(!s)return console.error("SessionCard received undefined note prop"),null;let i=s.sessionDate instanceof Date?s.sessionDate.toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}):new Date(s.sessionDate).toLocaleString([],{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"});return(0,n.jsxs)("div",{className:d().card,onClick:()=>null==a?void 0:a(s.id),role:"button",tabIndex:0,children:[(0,n.jsxs)("header",{className:d().header,children:[(0,n.jsx)("strong",{children:s.clientInitials}),(0,n.jsx)("span",{className:d().date,children:i})]}),(0,n.jsx)("section",{className:d().preview,children:(0,n.jsxs)("p",{children:[(null==(t=s.structuredContent)?void 0:t.slice(0,120))||"No content","..."]})})]})}function _(e){let{notes:t,viewMode:s,onUpdate:o,onDelete:r,onClick:i}=e,l=(0,a.useMemo)(()=>t.reduce((e,t)=>{var s;return(e[s=t.clientInitials]||(e[s]=[])).push(t),e},{}),[t]);return(0,n.jsxs)("div",{className:c().container,children:["byNote"===s&&(0,n.jsx)("div",{className:c().list,children:t.slice().sort((e,t)=>t.sessionDate.getTime()-e.sessionDate.getTime()).map(e=>(0,n.jsx)(u,{note:e,onClick:i,onUpdate:o,onDelete:r},e.id))}),"byClient"===s&&(0,n.jsx)("div",{className:c().list,children:Object.entries(l).map(e=>{let[t,s]=e;return(0,n.jsxs)("div",{className:c().clientGroup,children:[(0,n.jsx)("h3",{className:c().clientHeader,children:t}),s.slice().sort((e,t)=>t.sessionDate.getTime()-e.sessionDate.getTime()).map(e=>(0,n.jsx)(u,{note:e,onClick:i,onUpdate:o,onDelete:r},e.id))]},t)})})]})}var h=s(4163),g=s.n(h),p=s(2733),m=s.n(p);function b(e){let{view:t,onChange:s}=e;return(0,n.jsxs)("div",{className:m().toggleContainer,children:[(0,n.jsx)("button",{type:"button",className:"".concat(m().toggleButton," ").concat("byNote"===t?m().active:""),onClick:()=>s("byNote"),children:"By Note"}),(0,n.jsx)("button",{type:"button",className:"".concat(m().toggleButton," ").concat("byClient"===t?m().active:""),onClick:()=>s("byClient"),children:"By Client"})]})}var v=s(6874),x=s.n(v),j=s(962),f=s(7078),N=s.n(f);function y(){return(0,n.jsxs)("div",{className:N().container,children:[(0,n.jsx)(j.A,{className:N().icon}),(0,n.jsx)("h2",{className:N().title,children:"No session notes yet"}),(0,n.jsx)("p",{className:N().message,children:"When you finish your first recording, your notes will appear here."}),(0,n.jsx)(x(),{href:"/session/record",children:(0,n.jsx)("button",{className:N().button,children:"Record a Session"})})]})}var C=s(741),S=s.n(C);function D(){return(0,n.jsxs)("div",{className:S().loadingContainer,children:[(0,n.jsx)("div",{className:S().spinner}),(0,n.jsx)("p",{children:"Loading..."})]})}function P(){let e=(0,o.useRouter)(),[t,s]=(0,a.useState)([]),[i,c]=(0,a.useState)(!0),[l,d]=(0,a.useState)(null),[u,h]=(0,a.useState)("byNote"),p=async()=>{c(!0);try{let t=r.j.currentUser;if(!t){e.push("/login"),c(!1);return}let n=await t.getIdToken();console.log("Got token:",n.substring(0,20)+"...");let a=await fetch("/api/sessions",{headers:{Authorization:"Bearer ".concat(n)}});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let o=await a.json();console.log("\uD83D\uDD25 Raw sessions from API:",o),console.log("\uD83D\uDD25 typeof data:",typeof o),console.log("\uD83D\uDD25 Array.isArray(data):",Array.isArray(o));let i=o.map(e=>{var t,s,n,a;return console.log("\uD83D\uDC40 Individual session before parsing:",e),{id:e.id,clientInitials:null!=(s=e.clientInitials)?s:"—",sessionDate:e.sessionDate?new Date(e.sessionDate):new Date,transcript:null!=(n=e.transcript)?n:"",structuredContent:null!=(a=null==(t=e.soapNote)?void 0:t.subjective)?a:""}});console.log("✅ Parsed sessions:",i),s(i),c(!1)}catch(e){console.error("Error fetching sessions:",e),d("Failed to load sessions"),c(!1)}};(0,a.useEffect)(()=>{p()},[]);let m=async(e,t)=>{try{let s=await fetch("/api/sessions/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:t.transcript,soapNote:{subjective:t.structuredContent}})});if(!s.ok)throw Error("Failed to update session: ".concat(s.status));await p()}catch(e){console.error("Error updating session:",e),alert(e.message||"Failed to save session")}},v=async e=>{try{let t=await fetch("/api/sessions/".concat(e),{method:"DELETE"});if(!t.ok)throw Error("Failed to delete session: ".concat(t.status));await p()}catch(e){console.error("Error deleting session:",e),alert(e.message||"Failed to delete session")}};return i?(0,n.jsx)(D,{}):l?(0,n.jsxs)("div",{children:["Error: ",l]}):0===t.length?(0,n.jsx)(y,{}):(0,n.jsxs)("div",{className:g().container,children:[(0,n.jsxs)("div",{className:g().header,children:[(0,n.jsx)("h1",{children:"Your Sessions"}),(0,n.jsx)(b,{view:u,onChange:h})]}),(0,n.jsx)(_,{notes:t,viewMode:u,onUpdate:m,onDelete:v,onClick:t=>{e.push("/session/".concat(t))}})]})}var w=s(1240),A=s(9576);function L(){let{user:e,loading:t}=(0,A.A)();console.log("DashboardPage: user from useAuth:",e),console.log("DashboardPage: loading from useAuth:",t);let s=(0,o.useRouter)();return((0,a.useEffect)(()=>{t||e||s.push("/login")},[e,t,s]),t)?(0,n.jsx)("p",{style:{padding:"2rem",textAlign:"center"},children:"Loading dashboard…"}):e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(w.A,{}),(0,n.jsx)(P,{})]}):(0,n.jsx)("p",{style:{padding:"2rem",textAlign:"center"},children:"Authentication failed or redirecting…"})}},9576:(e,t,s)=>{"use strict";s.d(t,{A:()=>c,AuthProvider:()=>i});var n=s(5155),a=s(2115),o=s(2239);let r=(0,a.createContext)(void 0),i=e=>{let{children:t}=e,[s,i]=(0,a.useState)(null),[c,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=o.j.onAuthStateChanged(e=>{i(e),l(!1)});return()=>e()},[]);let d=async()=>{await o.j.signOut()};return(0,n.jsx)(r.Provider,{value:{user:s,loading:c,signOut:d},children:t})},c=()=>{let e=(0,a.useContext)(r);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{var t=t=>e(e.s=t);e.O(0,[4402,93,2992,6874,6766,3915,9207,8441,1684,7358],()=>t(4454)),_N_E=e.O()}]);